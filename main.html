<!--
    Contributors:
-->
<!-- 
    About the Project:
-->

<!DOCTYPE html>
<html>
<head>
    <title>CMPM163 Final Project</title>
    <style>
        body { 
            margin: 0;
            overflow: hidden;
         }
    </style>
</head>
<body>

    <div id="container"></div>

    <!-- Loading external libraries -->
    <script src="js/three.js"></script>
    <script src="js/cmengine.js"></script>
    <script src="js/OrbitControls.js"></script>

    <!-- Loading external shaders -->
    <script src="shaders/basic-shader.js"></script>
    <script src="shaders/water-shader.js"></script>

    <!-- Loading external objects -->
    <script src="js/objects/simple-box.js"></script>
    <script src="js/objects/water-plane.js"></script>

    <script>

        var container = document.getElementById('container');

        // renderer
        var renderer = new THREE.WebGLRenderer();
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        // scene
        var scene = new THREE.Scene();
		
		//skybox - will find a better/clear one at some point
		var loader = new THREE.CubeTextureLoader();
		loader.setPath('images/skybox/temp/');
		scene.background = loader.load(['left.jpg', 'right.jpg',
									'top.jpg', 'bottom.jpg',
									'back.jpg', 'front.jpg']);

        // camera
        var camera = new THREE.PerspectiveCamera( 50, window.innerWidth/window.innerHeight, 0.1, 1000 );
        camera.position.z = 15.0;
        camera.position.y = 10.0;

        // FrameBufferObject: bufferScene will contain everything in scene except for the water
        // bufferObjectRefraction / Reflection create an off-screen buffer. (Frame Buffer Object)!Update this for windowResize
        var bufferObjectRefraction = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight); 
        var bufferObjectReflection = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight);
        var bufferScene = new THREE.Scene();
        bufferScene.background = loader.load(['left.jpg', 'right.jpg',
                                            'top.jpg', 'bottom.jpg',
                                            'back.jpg', 'front.jpg']);

            // add all objects to buffer scene except for water
            var bufferBox = createSimpleBox(1.0,1.0,1.0);
            bufferScene.add(bufferBox);

        // create objects
        var water = createWaterPlane(20, 20, bufferObjectRefraction.texture, bufferObjectReflection.texture);
        var box = createSimpleBox(1.0, 1.0, 1.0);

        // add objects to the scene
        scene.add(box);
        scene.add(water);

        // Creating a clipping plane that is applied to the frame buffer objects
        var globalPlanes = [new THREE.Plane( new THREE.Vector3(0, -1, 0), water.position.y),  //<- Refraction
                            new THREE.Plane( new THREE.Vector3(0,  1, 0), water.position.y)]; //<- Reflection
        renderer.clippingPlanes = globalPlanes;


        // CMENGINE
        CMENGINE.Start( scene, renderer, camera, bufferScene, bufferObjectRefraction, bufferObjectReflection );
        CMENGINE.Update();

    </script>

</body>
</html>